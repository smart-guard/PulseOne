# =============================================================================
# collector/tests/Makefile - ğŸš€ ê³ ì† ì¦ë¶„ ì»´íŒŒì¼ + ë“œë¼ì´ë²„ ë°ì´í„° ê²€ì¦ ì¶”ê°€
# =============================================================================

# ğŸš€ ì„±ëŠ¥ ìµœì í™” ì„¤ì •
NPROC := $(shell nproc 2>/dev/null || echo 4)
MAKEFLAGS += -j$(NPROC) --output-sync=target

# ğŸ”§ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì²´í¬ (ìºì‹œëœ ê²°ê³¼ ì‚¬ìš©)
HAS_NLOHMANN_JSON := $(shell echo '\#include <nlohmann/json.hpp>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")
HAS_HIREDIS := $(shell echo '\#include <hiredis/hiredis.h>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")
HAS_MQTT_C := $(shell echo "int main(){return 0;}" | $(CXX) -x c++ - -lpaho-mqtt3c >/dev/null 2>&1 && echo "1" || echo "0")
HAS_MQTT_CPP := $(shell echo "int main(){return 0;}" | $(CXX) -x c++ - -lpaho-mqttpp3 >/dev/null 2>&1 && echo "1" || echo "0")
HAS_BACNET_STACK := $(shell [ -f "/usr/local/lib/libbacnet.a" ] && echo "1" || echo "0")

# ì»´íŒŒì¼ëŸ¬ ì„¤ì • (ğŸš€ ìµœì í™”ë¨)
CXX = g++
CXXFLAGS = -std=c++17 -Wall -Wextra -g -DPULSEONE_DEBUG_MODE \
           -O1 -fno-omit-frame-pointer \
           -Wno-unused-but-set-variable -Wno-unused-variable \
           -fdiagnostics-color=always

# ğŸš€ ì¦ë¶„ ì»´íŒŒì¼ìš© ë””ë ‰í† ë¦¬
OBJ_DIR = ./obj
BIN_DIR = ./bin
DATA_DIR = ./data

# ê²½ë¡œ ì„¤ì •
PARENT_DIR = ..
INCLUDE_DIR = $(PARENT_DIR)/include
SRC_DIR = $(PARENT_DIR)/src

# Include ê²½ë¡œ
INCLUDES = -I$(INCLUDE_DIR)

# ğŸ”§ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì • (ê¸°ì¡´ê³¼ ë™ì¼)
ifneq ($(shell echo "int main(){return 0;}" | $(CXX) -x c++ - -lmodbus >/dev/null 2>&1; echo $$?),0)
    MODBUS_LIBS = 
    MODBUS_INCLUDES = 
else
    MODBUS_LIBS = -lmodbus
    MODBUS_INCLUDES = $(shell pkg-config --cflags libmodbus 2>/dev/null || echo "")
    INCLUDES += $(MODBUS_INCLUDES)
endif

MYSQL_CONFIG := $(shell which mysql_config 2>/dev/null)
ifneq ($(MYSQL_CONFIG),)
    MYSQL_LIBS = $(shell mysql_config --libs)
    MYSQL_INCLUDES = $(shell mysql_config --include)
    INCLUDES += $(MYSQL_INCLUDES)
else
    MYSQL_LIBS = 
    CXXFLAGS += -DDISABLE_MYSQL_FEATURES
endif

ifeq ($(HAS_MQTT_C),1)
    MQTT_C_LIBS = -lpaho-mqtt3c
else
    MQTT_C_LIBS = 
endif

ifeq ($(HAS_MQTT_CPP),1)
    MQTT_CPP_LIBS = -lpaho-mqttpp3
    INCLUDES += -I/usr/local/include
else
    MQTT_CPP_LIBS = 
endif

ifneq ($(shell echo "int main(){return 0;}" | $(CXX) -x c++ - -lpqxx >/dev/null 2>&1; echo $$?),0)
    PGSQL_LIBS = 
else
    PGSQL_LIBS = -lpqxx -lpq
endif

ifeq ($(HAS_BACNET_STACK), 1)
    BACNET_LIBS = -lbacnet -lm
    BACNET_INCLUDES = -I/usr/local/include/bacnet
    INCLUDES += $(BACNET_INCLUDES)
    CXXFLAGS += -DHAS_BACNET_STACK=1
else
    CXXFLAGS += -DHAS_BACNET_STACK=0
    BACNET_LIBS = 
endif

ifeq ($(HAS_HIREDIS),1)
    REDIS_LIBS = -lhiredis -lhiredis_ssl
    CXXFLAGS += -DHAS_HIREDIS
else
    REDIS_LIBS = 
endif

ifeq ($(HAS_NLOHMANN_JSON),1)
    CXXFLAGS += -DHAS_NLOHMANN_JSON
endif

# ì „ì²´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì •
BASIC_LIBS = -lpthread -lsqlite3 $(shell pkg-config --libs quickjs) -lquickjs -lm -ldl
OPTIONAL_LIBS = $(MODBUS_LIBS) $(MYSQL_LIBS) $(PGSQL_LIBS) $(MQTT_C_LIBS) $(MQTT_CPP_LIBS) $(BACNET_LIBS) $(REDIS_LIBS)
LIBS = $(BASIC_LIBS) $(OPTIONAL_LIBS)
TEST_LIBS = -lgtest -lgtest_main -pthread

# =============================================================================
# ğŸš€ ì†ŒìŠ¤ íŒŒì¼ ë° ì˜¤ë¸Œì íŠ¸ íŒŒì¼ ì •ì˜ (ëª¨ë“  íŒŒì¼ í¬í•¨)
# =============================================================================

# ëª¨ë“  ì†ŒìŠ¤ íŒŒì¼ ìˆ˜ì§‘ (ê¸°ì¡´ê³¼ ë™ì¼)
UTILS_SOURCES := $(wildcard $(SRC_DIR)/Utils/*.cpp)
CONFIG_SOURCES := $(wildcard $(SRC_DIR)/Config/*.cpp)
DATABASE_SOURCES := $(wildcard $(SRC_DIR)/Database/*.cpp) \
                   $(wildcard $(SRC_DIR)/Database/Entities/*.cpp) \
                   $(wildcard $(SRC_DIR)/Database/Repositories/*.cpp)
CLIENT_SOURCES := $(wildcard $(SRC_DIR)/Client/*.cpp)
WORKERS_SOURCES := $(wildcard $(SRC_DIR)/Workers/Base/*.cpp) \
                  $(wildcard $(SRC_DIR)/Workers/Protocol/*.cpp) \
                  $(wildcard $(SRC_DIR)/Workers/Components/*.cpp) \
                  $(wildcard $(SRC_DIR)/Workers/WorkerFactory.cpp)

# Drivers ì†ŒìŠ¤ë“¤ (ì¡°ê±´ë¶€ í¬í•¨)
DRIVERS_SOURCES = $(wildcard $(SRC_DIR)/Drivers/Common/*.cpp)
ifneq ($(MODBUS_LIBS),)
    DRIVERS_SOURCES += $(wildcard $(SRC_DIR)/Drivers/Modbus/*.cpp)
endif
ifeq ($(HAS_MQTT_CPP),1)
    DRIVERS_SOURCES += $(wildcard $(SRC_DIR)/Drivers/Mqtt/*.cpp)
endif
ifeq ($(HAS_BACNET_STACK),1)
    DRIVERS_SOURCES += $(wildcard $(SRC_DIR)/Drivers/Bacnet/*.cpp)
endif

PIPELINE_SOURCES := $(wildcard $(SRC_DIR)/Pipeline/*.cpp)

# ğŸš€ ì „ì²´ ì†ŒìŠ¤ íŒŒì¼ (ëª¨ë“  íŒŒì¼ í¬í•¨)
ALL_SOURCES = $(UTILS_SOURCES) $(CONFIG_SOURCES) $(DATABASE_SOURCES) \
              $(CLIENT_SOURCES) $(WORKERS_SOURCES) $(DRIVERS_SOURCES) \
              $(PIPELINE_SOURCES)

# ğŸš€ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ ìƒì„± (ì¦ë¶„ ì»´íŒŒì¼ìš©)
ALL_OBJECTS = $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(ALL_SOURCES))

# ğŸ”¥ í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤ ì •ì˜
TEST_OBJECTS = $(OBJ_DIR)/test_step3_workers.o \
               $(OBJ_DIR)/test_step4_driver_data_validation.o \
               $(OBJ_DIR)/test_step5_complete_db_integration_validation.o \
               $(OBJ_DIR)/test_step6_full_pipeline.o

# ìƒ‰ìƒ ì •ì˜
GREEN = \033[0;32m
BLUE = \033[0;34m
YELLOW = \033[1;33m
RED = \033[0;31m
PURPLE = \033[0;35m
NC = \033[0m

# =============================================================================
# ğŸš€ ì¦ë¶„ ì»´íŒŒì¼ íƒ€ê²Ÿë“¤
# =============================================================================

.DEFAULT_GOAL := help

# ë””ë ‰í† ë¦¬ ìƒì„±
$(OBJ_DIR):
	@echo -e "$(BLUE)ğŸ“ Creating object directories...$(NC)"
	@mkdir -p $(OBJ_DIR)
	@mkdir -p $(OBJ_DIR)/Utils $(OBJ_DIR)/Config $(OBJ_DIR)/Database/Entities $(OBJ_DIR)/Database/Repositories
	@mkdir -p $(OBJ_DIR)/Client $(OBJ_DIR)/Workers/Base $(OBJ_DIR)/Workers/Protocol $(OBJ_DIR)/Workers/Components
	@mkdir -p $(OBJ_DIR)/Drivers/Common $(OBJ_DIR)/Drivers/Modbus $(OBJ_DIR)/Drivers/Mqtt $(OBJ_DIR)/Drivers/Bacnet
	@mkdir -p $(OBJ_DIR)/Pipeline

$(BIN_DIR):
	@mkdir -p $(BIN_DIR)

# ğŸš€ ê°œë³„ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ ì»´íŒŒì¼ (ì¦ë¶„ ì»´íŒŒì¼)
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”¨ Compiling $<$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# ğŸš€ í…ŒìŠ¤íŠ¸ íŒŒì¼ë“¤ ì»´íŒŒì¼
$(OBJ_DIR)/test_step3_workers.o: test_step3_workers.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”¨ Compiling test_step3_workers...$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

$(OBJ_DIR)/test_step4_driver_data_validation.o: test_step4_driver_data_validation.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”¨ Compiling test_step4_driver_data_validation...$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

$(OBJ_DIR)/test_step5_complete_db_integration_validation.o: test_step5_complete_db_integration_validation.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”¨ Compiling test_step5_complete_db_integration_validation...$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

$(OBJ_DIR)/test_step6_full_pipeline.o: test_step6_full_pipeline.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”¨ Compiling test_step6_full_pipeline...$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# =============================================================================
# ğŸš€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íŒŒì¼ë“¤ (ê°œë³„)
# =============================================================================

# Step 3: Workers í…ŒìŠ¤íŠ¸
$(BIN_DIR)/test_step3: $(ALL_OBJECTS) $(OBJ_DIR)/test_step3_workers.o | $(BIN_DIR)
	@echo -e "$(PURPLE)ğŸ”— Linking test_step3...$(NC)"
	@$(CXX) $(ALL_OBJECTS) $(OBJ_DIR)/test_step3_workers.o $(TEST_LIBS) $(LIBS) -o $@
	@echo -e "$(GREEN)âœ… test_step3 build completed!$(NC)"

# Step 4: Driver ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸
$(BIN_DIR)/test_step4: $(ALL_OBJECTS) $(OBJ_DIR)/test_step4_driver_data_validation.o | $(BIN_DIR)
	@echo -e "$(PURPLE)ğŸ”— Linking test_step4 (Driver Data Validation)...$(NC)"
	@$(CXX) $(ALL_OBJECTS) $(OBJ_DIR)/test_step4_driver_data_validation.o $(TEST_LIBS) $(LIBS) -o $@
	@echo -e "$(GREEN)âœ… test_step4 (Driver Data Validation) build completed!$(NC)"

# Step 5: DB í†µí•© ê²€ì¦ í…ŒìŠ¤íŠ¸
$(BIN_DIR)/test_step5: $(ALL_OBJECTS) $(OBJ_DIR)/test_step5_complete_db_integration_validation.o | $(BIN_DIR)
	@echo -e "$(PURPLE)ğŸ”— Linking test_step5...$(NC)"
	@$(CXX) $(ALL_OBJECTS) $(OBJ_DIR)/test_step5_complete_db_integration_validation.o $(TEST_LIBS) $(LIBS) -o $@
	@echo -e "$(GREEN)âœ… test_step5 build completed!$(NC)"

# Step 6: Redis íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
$(BIN_DIR)/test_step6: $(ALL_OBJECTS) $(OBJ_DIR)/test_step6_full_pipeline.o | $(BIN_DIR)
	@echo -e "$(PURPLE)ğŸ”— Linking test_step6 (Redis Pipeline)...$(NC)"
	@$(CXX) $(ALL_OBJECTS) $(OBJ_DIR)/test_step6_full_pipeline.o $(TEST_LIBS) $(LIBS) -o $@
	@echo -e "$(GREEN)âœ… test_step6 (Redis Pipeline) build completed!$(NC)"

# =============================================================================
# ğŸš€ ë©”ì¸ íƒ€ê²Ÿë“¤
# =============================================================================

# ê°œë³„ í…ŒìŠ¤íŠ¸ ë¹Œë“œ
step3-build: $(BIN_DIR)/test_step3
	@echo -e "$(GREEN)ğŸš€ Step 3 (Workers) build completed!$(NC)"

step4-build: $(BIN_DIR)/test_step4
	@echo -e "$(GREEN)ğŸš€ Step 4 (Driver Data Validation) build completed!$(NC)"

step5-build: $(BIN_DIR)/test_step5
	@echo -e "$(GREEN)ğŸš€ Step 5 (Complete DB Integration) build completed!$(NC)"

step6-build: $(BIN_DIR)/test_step6
	@echo -e "$(GREEN)ğŸš€ Step 6 (Redis Pipeline) build completed!$(NC)"

# ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
step3-test: step3-build
	@echo -e "$(PURPLE)ğŸ§ª Running Step 3 (Workers) tests...$(NC)"
	@./$(BIN_DIR)/test_step3

step4-test: step4-build
	@echo -e "$(PURPLE)ğŸ§ª Running Step 4 (Driver Data Validation) tests...$(NC)"
	@./$(BIN_DIR)/test_step4

step5-test: step5-build
	@echo -e "$(PURPLE)ğŸ§ª Running Step 5 (Complete DB Integration) tests...$(NC)"
	@./$(BIN_DIR)/test_step5

step6-test: step6-build
	@echo -e "$(PURPLE)ğŸ§ª Running Step 6 (Redis Pipeline) tests...$(NC)"
	@echo -e "$(CYAN)ğŸ“Š ì´ í…ŒìŠ¤íŠ¸ëŠ” Redis ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤$(NC)"
	@./$(BIN_DIR)/test_step6

# ğŸ”¥ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë¹Œë“œ
all-tests-build: $(BIN_DIR)/test_step3 $(BIN_DIR)/test_step4 $(BIN_DIR)/test_step5 $(BIN_DIR)/test_step6
	@echo -e "$(GREEN)ğŸ‰ All tests build completed (Step 3-6)!$(NC)"

# ğŸ”¥ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ìˆœì„œëŒ€ë¡œ)
all-tests-run: all-tests-build
	@echo -e "$(BLUE)ğŸš€ Running all tests in sequence (Step 3-6)...$(NC)"
	@echo -e "$(YELLOW)======================================$(NC)"
	@echo -e "$(PURPLE)ğŸ§ª Step 3: Workers Test$(NC)"
	@./$(BIN_DIR)/test_step3
	@echo -e "$(YELLOW)======================================$(NC)"
	@echo -e "$(PURPLE)ğŸ§ª Step 4: Driver Data Validation Test$(NC)"
	@./$(BIN_DIR)/test_step4
	@echo -e "$(YELLOW)======================================$(NC)"
	@echo -e "$(PURPLE)ğŸ§ª Step 5: Complete DB Integration Test$(NC)"
	@./$(BIN_DIR)/test_step5
	@echo -e "$(YELLOW)======================================$(NC)"
	@echo -e "$(PURPLE)ğŸ§ª Step 6: Redis Pipeline Test$(NC)"
	@./$(BIN_DIR)/test_step6
	@echo -e "$(GREEN)ğŸ‰ All tests completed (Step 3-6)!$(NC)"

# ì „ì²´ í´ë¦° ë¹Œë“œ
full-build: clean all-tests-build
	@echo -e "$(GREEN)ğŸ—ï¸  Full build completed!$(NC)"

# ğŸš€ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ê¸°ì¡´ í˜¸í™˜)
test: step3-test

# í´ë¦°
clean:
	@echo -e "$(YELLOW)ğŸ§¹ Cleaning...$(NC)"
	@rm -rf $(OBJ_DIR) $(BIN_DIR)
	@echo -e "$(GREEN)âœ… Clean completed$(NC)"

# ğŸ” ë¹Œë“œ ìƒíƒœ í™•ì¸
status:
	@echo -e "$(BLUE)ğŸ“Š Build Status$(NC)"
	@echo -e "$(YELLOW)===============$(NC)"
	@echo "Object files: $(words $(wildcard $(OBJ_DIR)/**/*.o)) / $(words $(ALL_OBJECTS))"
	@echo "Source files: $(words $(ALL_SOURCES))"
	@echo "Step 3 binary: $(if $(wildcard $(BIN_DIR)/test_step3),âœ… exists,âŒ missing)"
	@echo "Step 4 binary: $(if $(wildcard $(BIN_DIR)/test_step4),âœ… exists,âŒ missing)"
	@echo "Step 5 binary: $(if $(wildcard $(BIN_DIR)/test_step5),âœ… exists,âŒ missing)"
	@echo "Step 6 binary: $(if $(wildcard $(BIN_DIR)/test_step6),âœ… exists,âŒ missing)"
	@echo ""
	@echo -e "$(BLUE)ğŸ”§ Libraries:$(NC)"
	@echo "  Modbus: $(if $(MODBUS_LIBS),âœ…,âŒ)"
	@echo "  MQTT: $(if $(MQTT_CPP_LIBS),âœ…,âŒ)"
	@echo "  BACnet: $(if $(BACNET_LIBS),âœ…,âŒ)"
	@echo "  Redis: $(if $(REDIS_LIBS),âœ…,âŒ)"

# ğŸš€ ê°œë°œìš© ì›Œí¬í”Œë¡œìš°ë“¤
dev-step3: step3-build step3-test
dev-step4: step4-build step4-test
dev-step5: step5-build step5-test
dev-step6: step6-build step6-test
dev-all: all-tests-run

# ì¢…ì†ì„± í™•ì¸ (ê¸°ì¡´ê³¼ ë™ì¼)
check-deps:
	@echo -e "$(BLUE)ğŸ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ì²´í¬$(NC)"
	@echo "  Total sources: $(words $(ALL_SOURCES))"
	@echo "  MQTT: $(if $(MQTT_CPP_LIBS),âœ… $(MQTT_CPP_LIBS),âŒ not found)"
	@echo "  Modbus: $(if $(MODBUS_LIBS),âœ… $(MODBUS_LIBS),âŒ not found)"
	@echo "  BACnet: $(if $(BACNET_LIBS),âœ… $(BACNET_LIBS),âŒ not found)"
	@echo "  Redis: $(if $(REDIS_LIBS),âœ… $(REDIS_LIBS),âŒ not found)"

# ë„ì›€ë§
help:
	@echo -e "$(BLUE)ğŸš€ PulseOne Fast Build System (with Step 6)$(NC)"
	@echo -e "$(YELLOW)============================================$(NC)"
	@echo ""
	@echo -e "$(GREEN)ğŸ”¥ ê°œë³„ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:$(NC)"
	@echo "  make step3-test   - ğŸ§ª Step 3: Workers í…ŒìŠ¤íŠ¸"
	@echo "  make step4-test   - ğŸ§ª Step 4: Driver ë°ì´í„° ê²€ì¦ í…ŒìŠ¤íŠ¸"
	@echo "  make step5-test   - ğŸ§ª Step 5: ì™„ì „í•œ DB í†µí•© í…ŒìŠ¤íŠ¸"
	@echo "  make step6-test   - ğŸ§ª Step 6: Redis íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ!)"
	@echo ""
	@echo -e "$(GREEN)ğŸš€ ë¹ ë¥¸ ë¹Œë“œ ëª…ë ¹ì–´:$(NC)"
	@echo "  make step3-build  - ğŸš€ Step 3 ë¹Œë“œë§Œ"
	@echo "  make step4-build  - ğŸš€ Step 4 ë¹Œë“œë§Œ"
	@echo "  make step5-build  - ğŸš€ Step 5 ë¹Œë“œë§Œ"
	@echo "  make step6-build  - ğŸš€ Step 6 ë¹Œë“œë§Œ (ì‹ ê·œ!)"
	@echo "  make all-tests-build - ğŸš€ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë¹Œë“œ (Step 3-6)"
	@echo ""
	@echo -e "$(GREEN)ğŸ¯ í†µí•© ì‹¤í–‰:$(NC)"
	@echo "  make all-tests-run - ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ (Step 3-6)"
	@echo "  make dev-all      - ğŸ”„ ê°œë°œ ì›Œí¬í”Œë¡œìš° (ë¹Œë“œ + ì „ì²´ í…ŒìŠ¤íŠ¸)"
	@echo ""
	@echo -e "$(GREEN)ğŸ—ï¸  ì „ì²´ ë¹Œë“œ:$(NC)"
	@echo "  make full-build   - ğŸ—ï¸  ì „ì²´ í´ë¦° ë¹Œë“œ"
	@echo "  make clean        - ğŸ§¹ ëª¨ë“  ë¹Œë“œ íŒŒì¼ ì‚­ì œ"
	@echo ""
	@echo -e "$(GREEN)ğŸ“Š ìƒíƒœ í™•ì¸:$(NC)"
	@echo "  make status       - ğŸ“Š ë¹Œë“œ ìƒíƒœ í™•ì¸"
	@echo "  make check-deps   - ğŸ” ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸"
	@echo ""
	@echo -e "$(PURPLE)ğŸ’¡ ê¶Œì¥ ì‚¬ìš©ë²•:$(NC)"
	@echo "  1ï¸âƒ£  ì²« ë¹Œë“œ: make full-build"
	@echo "  2ï¸âƒ£  ê°œë³„ í…ŒìŠ¤íŠ¸: make step6-test (Redis íŒŒì´í”„ë¼ì¸)"
	@echo "  3ï¸âƒ£  ì „ì²´ ê²€ì¦: make all-tests-run"
	@echo "  4ï¸âƒ£  ê°œë°œ ì¤‘: make dev-step6 (ë¹ ë¥¸ ê°œë°œ)"
	@echo ""
	@echo -e "$(RED)ğŸ”¥ Step 6 ì‹ ê·œ ê¸°ëŠ¥:$(NC)"
	@echo "  - Redis ì—°ê²° ë° ë°ì´í„° ì €ì¥ í…ŒìŠ¤íŠ¸"
	@echo "  - ë””ë°”ì´ìŠ¤ ìŠ¤ìº”ë¶€í„° Redis ì €ì¥ê¹Œì§€ ì™„ì „í•œ íŒŒì´í”„ë¼ì¸"
	@echo "  - ì„±ëŠ¥ ì¸¡ì • ë° ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦"

# ğŸš€ ìë™ ì¢…ì†ì„± ìƒì„± (ê³ ê¸‰ ê¸°ëŠ¥)
-include $(ALL_OBJECTS:.o=.d)

$(OBJ_DIR)/%.d: $(SRC_DIR)/%.cpp | $(OBJ_DIR)
	@echo -e "$(YELLOW)ğŸ”— Generating dependencies for $<$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -MM -MT $(OBJ_DIR)/$*.o $< > $@

.PHONY: fast-build full-build test clean status check-deps help \
        step3-build step3-test step4-build step4-test step5-build step5-test \
        step6-build step6-test all-tests-build all-tests-run \
        dev-step3 dev-step4 dev-step5 dev-step6 dev-all