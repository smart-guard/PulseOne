# =============================================================================
# core/export-gateway/Makefile - PulseOne Export Gateway (ÌÅ¨Î°úÏä§ÌîåÎû´Ìèº)
# üî• AlarmSubscriber & PeriodicExporter Ï∂îÍ∞Ä ÏôÑÎ£å Î≤ÑÏ†Ñ
# =============================================================================

# ÌîåÎû´Ìèº Í∞êÏßÄ
UNAME := $(shell uname -s 2>/dev/null || echo Windows)
ifeq ($(UNAME),Linux)
    PLATFORM := Linux
    IS_WINDOWS := 0
else ifeq ($(OS),Windows_NT)
    PLATFORM := Windows
    IS_WINDOWS := 1
else
    PLATFORM := $(UNAME)
    IS_WINDOWS := 0
endif

# Ïª¥ÌååÏùºÎü¨ ÏÑ§Ï†ï
CXX = g++
CC = gcc

# Í∏∞Î≥∏ Ïª¥ÌååÏùº ÌîåÎûòÍ∑∏
CXXFLAGS = -std=c++17 -Wall -Wextra -O2 -fPIC
CFLAGS = -std=c11 -Wall -Wextra -O2 -fPIC

# Windows ÌÅ¨Î°úÏä§ Ïª¥ÌååÏùº ÏßÄÏõê
ifeq ($(CROSS_COMPILE_WINDOWS),1)
    CXX = x86_64-w64-mingw32-g++
    CC = x86_64-w64-mingw32-gcc
    CXXFLAGS += -DWIN32 -D_WIN32_WINNT=0x0601 -DWIN32_LEAN_AND_MEAN -DNOMINMAX
    CFLAGS += -DWIN32 -D_WIN32_WINNT=0x0601 -DWIN32_LEAN_AND_MEAN -DNOMINMAX
    PLATFORM := Windows-Cross
    MINGW_PREFIX = /usr/x86_64-w64-mingw32
    INCLUDES += -I$(MINGW_PREFIX)/include
    EXE_SUFFIX = .exe
    LIB_SUFFIX = .a
else ifeq ($(IS_WINDOWS),1)
    CXXFLAGS += -DPULSEONE_WINDOWS=1
    CFLAGS += -DPULSEONE_WINDOWS=1
    EXE_SUFFIX = .exe
    LIB_SUFFIX = .a
else
    CXXFLAGS += -DPULSEONE_LINUX=1
    CFLAGS += -DPULSEONE_LINUX=1
    EXE_SUFFIX =
    LIB_SUFFIX = .a
endif

# ÎîîÎ≤ÑÍ∑∏/Î¶¥Î¶¨Ï¶à ÌîåÎûòÍ∑∏
ifeq ($(BUILD_TYPE),Debug)
    CXXFLAGS += -g -O0 -fno-omit-frame-pointer
    CXXFLAGS += -DPULSEONE_DEBUG=1
else
    CXXFLAGS += -DNDEBUG -O2
    CXXFLAGS += -DPULSEONE_DEBUG=0
endif

# =============================================================================
# ÎîîÎ†âÌÜ†Î¶¨ Íµ¨Ï°∞
# =============================================================================

EXPORT_GATEWAY_DIR = $(shell pwd)
PROJECT_ROOT = $(shell dirname $(shell dirname $(EXPORT_GATEWAY_DIR)))
SHARED_DIR = $(PROJECT_ROOT)/core/shared

SRC_DIR = src
INCLUDE_DIR = include
BUILD_DIR = build
BIN_DIR = bin

SHARED_INCLUDE_DIR = $(SHARED_DIR)/include
SHARED_LIB_DIR = $(SHARED_DIR)/lib

# =============================================================================
# ÎùºÏù¥Î∏åÎü¨Î¶¨ Í∞êÏßÄ
# =============================================================================

HAS_SHARED := $(shell [ -d "$(SHARED_LIB_DIR)" ] && [ -f "$(SHARED_LIB_DIR)/libpulseone-common$(LIB_SUFFIX)" ] && echo "1" || echo "0")
HAS_NLOHMANN_JSON := $(shell echo '\#include <nlohmann/json.hpp>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")

# üî• hiredis Í∞êÏßÄ (pkg-config Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ Ìó§Îçî ÌÖåÏä§Ìä∏)
HAS_HIREDIS := $(shell pkg-config --exists hiredis 2>/dev/null && echo "1" || echo "0")
ifeq ($(HAS_HIREDIS),0)
    HAS_HIREDIS := $(shell echo '\#include <hiredis/hiredis.h>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")
endif

HAS_HTTPLIB := $(shell echo '\#include <httplib.h>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")

# üî• libcurl ÏûêÎèô Í∞êÏßÄ (pkg-config Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ ÏßÅÏ†ë ÌÖåÏä§Ìä∏)
HAS_CURL := $(shell pkg-config --exists libcurl 2>/dev/null && echo "1" || echo "0")
ifeq ($(HAS_CURL),0)
    HAS_CURL := $(shell echo '\#include <curl/curl.h>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")
endif

# OpenSSL Í∞êÏßÄ (S3 ÏÑúÎ™ÖÏö©)
HAS_OPENSSL := $(shell pkg-config --exists openssl 2>/dev/null && echo "1" || echo "0")
ifeq ($(HAS_OPENSSL),0)
    HAS_OPENSSL := $(shell echo '\#include <openssl/sha.h>' | $(CXX) -E -x c++ - >/dev/null 2>&1 && echo "1" || echo "0")
endif

# =============================================================================
# Include Í≤ΩÎ°úÎì§
# =============================================================================

INCLUDES = -I$(INCLUDE_DIR)

ifeq ($(HAS_SHARED),1)
    INCLUDES := -I$(SHARED_INCLUDE_DIR) $(INCLUDES)
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Platform
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Common
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Utils
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Database
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Database/Entities
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Database/Repositories
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Alarm
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Export
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Client
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Security
    INCLUDES += -I$(SHARED_INCLUDE_DIR)/Data
endif

INCLUDES += -I/usr/local/include

ifeq ($(CROSS_COMPILE_WINDOWS),1)
    INCLUDES += -I$(MINGW_PREFIX)/include
endif

# =============================================================================
# ÎùºÏù¥Î∏åÎü¨Î¶¨ ÎßÅÌÅ¨
# =============================================================================

# Shared ÎùºÏù¥Î∏åÎü¨Î¶¨
ifeq ($(HAS_SHARED),1)
    SHARED_LIBS = -L$(SHARED_LIB_DIR)
    SHARED_LIBS += -lpulseone-alarm
    SHARED_LIBS += -lpulseone-export
    SHARED_LIBS += -lpulseone-data
    SHARED_LIBS += -lpulseone-database  
    SHARED_LIBS += -lpulseone-client
    SHARED_LIBS += -lpulseone-common
    SHARED_LIBS += -lpulseone-security
    CXXFLAGS += -DHAS_SHARED_LIBS=1
    $(info ‚úÖ HAS_SHARED=1 detected - LogManager available)
else
    SHARED_LIBS =
    $(info ‚ö†Ô∏è  HAS_SHARED=0 - LogManager not available)
endif

# Ïô∏Î∂Ä ÎùºÏù¥Î∏åÎü¨Î¶¨Îì§
UTILITY_LIBS =

# üî• hiredis ÎßÅÌÅ¨ (pkg-config Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ ÏßÅÏ†ë ÎßÅÌÅ¨)
ifeq ($(HAS_HIREDIS),1)
    HIREDIS_LIBS := $(shell pkg-config --libs hiredis 2>/dev/null)
    ifneq ($(HIREDIS_LIBS),)
        UTILITY_LIBS += $(HIREDIS_LIBS)
        CXXFLAGS += -DHAVE_REDIS=1
        $(info ‚úÖ hiredis found via pkg-config)
    else
        UTILITY_LIBS += -lhiredis
        CXXFLAGS += -DHAVE_REDIS=1
        $(info ‚úÖ hiredis found (direct link))
    endif
else
    $(info ‚ö†Ô∏è  hiredis not found - Redis features disabled)
endif

# üî• libcurl ÎßÅÌÅ¨ (pkg-config Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ ÏßÅÏ†ë ÎßÅÌÅ¨)
ifeq ($(HAS_CURL),1)
    CURL_LIBS := $(shell pkg-config --libs libcurl 2>/dev/null)
    ifneq ($(CURL_LIBS),)
        UTILITY_LIBS += $(CURL_LIBS)
        CXXFLAGS += -DHAS_CURL=1
        $(info ‚úÖ libcurl found via pkg-config)
    else
        UTILITY_LIBS += -lcurl
        CXXFLAGS += -DHAS_CURL=1
        $(info ‚úÖ libcurl found (direct link))
    endif
else
    $(info ‚ö†Ô∏è  libcurl not found - HTTP/S3 features disabled)
endif

# üî• OpenSSL ÎßÅÌÅ¨ (S3 ÏÑúÎ™ÖÏö©)
ifeq ($(HAS_OPENSSL),1)
    OPENSSL_LIBS := $(shell pkg-config --libs openssl 2>/dev/null)
    ifneq ($(OPENSSL_LIBS),)
        UTILITY_LIBS += $(OPENSSL_LIBS)
        CXXFLAGS += -DHAS_OPENSSL=1
        $(info ‚úÖ OpenSSL found via pkg-config)
    else
        UTILITY_LIBS += -lssl -lcrypto
        CXXFLAGS += -DHAS_OPENSSL=1
        $(info ‚úÖ OpenSSL found (direct link))
    endif
else
    $(info ‚ö†Ô∏è  OpenSSL not found - S3 signature features disabled)
endif

ifeq ($(HAS_HTTPLIB),1)
    CXXFLAGS += -DHAVE_HTTPLIB=1
endif

ifeq ($(HAS_NLOHMANN_JSON),1)
    CXXFLAGS += -DHAS_NLOHMANN_JSON=1
endif

# üî• Í∏∞Î≥∏ ÏãúÏä§ÌÖú ÎùºÏù¥Î∏åÎü¨Î¶¨ (SQLite3 Ï∂îÍ∞Ä!)
ifeq ($(IS_WINDOWS),1)
    BASIC_LIBS = -lpthread -lstdc++ -lm -lsqlite3
    PLATFORM_LIBS = -lws2_32 -lwsock32 -liphlpapi
else
    BASIC_LIBS = -lpthread -lm -ldl -lsqlite3
    PLATFORM_LIBS =
endif

# üî• ÏµúÏ¢Ö ÎßÅÌÅ¨ ÏàúÏÑú (Ï§ëÏöî: curlÍ≥º sslÏùÄ shared libs Îí§Ïóê)
LDFLAGS = $(SHARED_LIBS) $(UTILITY_LIBS) $(BASIC_LIBS) $(PLATFORM_LIBS)

# ÏÉâÏÉÅ Ï†ïÏùò
GREEN = \033[0;32m
BLUE = \033[0;34m
YELLOW = \033[1;33m
RED = \033[0;31m
NC = \033[0m

# =============================================================================
# ÏÜåÏä§ ÌååÏùº Î∞è Ïò§Î∏åÏ†ùÌä∏ ÌååÏùº
# =============================================================================

# üÜï Alarm ÎîîÎ†âÌÜ†Î¶¨
ALARM_SOURCES = $(wildcard $(SRC_DIR)/Alarm/*.cpp)
ALARM_OBJECTS = $(ALARM_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

# üÜï Schedule ÎîîÎ†âÌÜ†Î¶¨ (Periodic ‚Üí ScheduleÎ°ú Î≥ÄÍ≤Ω)
SCHEDULE_SOURCES = $(wildcard $(SRC_DIR)/Schedule/*.cpp)
SCHEDULE_OBJECTS = $(SCHEDULE_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

# Í∏∞Ï°¥ ÎîîÎ†âÌÜ†Î¶¨Îì§
CSP_SOURCES = $(wildcard $(SRC_DIR)/CSP/*.cpp)
CSP_OBJECTS = $(CSP_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

EXPORT_SOURCES = $(wildcard $(SRC_DIR)/Export/*.cpp)
EXPORT_OBJECTS = $(EXPORT_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

UTILS_SOURCES = $(wildcard $(SRC_DIR)/Utils/*.cpp)
UTILS_OBJECTS = $(UTILS_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

MAIN_SOURCES = $(wildcard $(SRC_DIR)/*.cpp)
MAIN_OBJECTS = $(MAIN_SOURCES:$(SRC_DIR)/%.cpp=$(BUILD_DIR)/%.o)

# üî• Î™®Îì† Ïò§Î∏åÏ†ùÌä∏ ÌååÏùº (Alarm, Schedule Ï∂îÍ∞Ä)
ALL_OBJECTS = $(ALARM_OBJECTS) $(SCHEDULE_OBJECTS) $(CSP_OBJECTS) $(EXPORT_OBJECTS) $(UTILS_OBJECTS) $(MAIN_OBJECTS)

TARGET = $(BIN_DIR)/export-gateway$(EXE_SUFFIX)

# =============================================================================
# Î©îÏù∏ ÌÉÄÍ≤üÎì§
# =============================================================================

.PHONY: all clean debug release test install help shared-check debug-config

all: shared-check $(BUILD_DIR) $(BIN_DIR) $(TARGET)

debug:
	@$(MAKE) BUILD_TYPE=Debug all

release:
	@$(MAKE) BUILD_TYPE=Release all

# =============================================================================
# ÎîîÎ†âÌÜ†Î¶¨ ÏÉùÏÑ±
# =============================================================================

$(BUILD_DIR) $(BIN_DIR):
	@mkdir -p $@
	@mkdir -p $(BUILD_DIR)/Alarm $(BUILD_DIR)/Schedule $(BUILD_DIR)/CSP $(BUILD_DIR)/Export $(BUILD_DIR)/Utils

# =============================================================================
# Shared ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏùòÏ°¥ÏÑ± Ï≤¥ÌÅ¨
# =============================================================================

shared-check:
	@echo -e "$(BLUE)üîç Checking PulseOne Shared Libraries [$(PLATFORM)]...$(NC)"
	@echo "Shared lib directory: $(SHARED_LIB_DIR)"
	@echo "HAS_SHARED: $(HAS_SHARED)"
	@echo "HAS_HIREDIS: $(HAS_HIREDIS)"
	@echo "HAS_CURL: $(HAS_CURL)"
	@echo "HAS_OPENSSL: $(HAS_OPENSSL)"
	@if [ ! -d "$(SHARED_LIB_DIR)" ]; then \
		echo -e "$(RED)‚ùå Shared library directory not found$(NC)"; \
		echo -e "$(YELLOW)üí° Build shared libraries: cd $(SHARED_DIR) && make all$(NC)"; \
		exit 1; \
	fi
	@echo -e "Shared libs:"
	@echo -e "  libpulseone-security: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-security$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
	@echo -e "  libpulseone-common: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-common$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
	@echo -e "  libpulseone-database: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-database$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
	@echo -e "  libpulseone-client: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-client$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
	@echo -e "  libpulseone-data: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-data$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå MISSING - Run: cd $(SHARED_DIR) && make data$(NC))"
	@echo -e "  libpulseone-export: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-export$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
	@echo -e "  libpulseone-alarm: $(if $(wildcard $(SHARED_LIB_DIR)/libpulseone-alarm$(LIB_SUFFIX)),$(GREEN)‚úÖ$(NC),$(RED)‚ùå$(NC))"
ifeq ($(HAS_SHARED),1)
	@echo -e "$(GREEN)‚úÖ HAS_SHARED_LIBS=1 - LogManager available$(NC)"
else
	@echo -e "$(YELLOW)‚ö†Ô∏è  HAS_SHARED_LIBS not set - Logging disabled$(NC)"
endif
	@echo -e "$(GREEN)‚úÖ Shared libraries checked$(NC)"

# =============================================================================
# Ïã§Ìñâ ÌååÏùº ÎπåÎìú
# =============================================================================

$(TARGET): $(ALL_OBJECTS) | $(BIN_DIR)
	@mkdir -p $(BIN_DIR)
	@echo -e "$(GREEN)üîó Linking Export Gateway [$(BUILD_TYPE)]...$(NC)"
	@$(CXX) $(ALL_OBJECTS) -o $@ $(LDFLAGS)
	@echo -e "$(GREEN)‚úÖ Export Gateway built: $@$(NC)"
	@echo -e "$(BLUE)üìä Compiled modules:$(NC)"
	@echo -e "  ‚úÖ Alarm: $(words $(ALARM_OBJECTS)) files"
	@echo -e "  ‚úÖ Schedule: $(words $(SCHEDULE_OBJECTS)) files"
	@echo -e "  ‚úÖ CSP: $(words $(CSP_OBJECTS)) files"
	@echo -e "  ‚úÖ Export: $(words $(EXPORT_OBJECTS)) files"
	@echo -e "  ‚úÖ Utils: $(words $(UTILS_OBJECTS)) files"
	@echo -e "  ‚úÖ Main: $(words $(MAIN_OBJECTS)) files"

# =============================================================================
# Ïò§Î∏åÏ†ùÌä∏ ÌååÏùº Ïª¥ÌååÏùº
# =============================================================================

$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp | $(BUILD_DIR)
	@mkdir -p $(dir $@)
	@echo -e "$(YELLOW)‚öôÔ∏è  Compiling $< [$(BUILD_TYPE)]$(NC)"
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# =============================================================================
# Ïú†Ìã∏Î¶¨Ìã∞
# =============================================================================

# ‚úÖ ÏàòÏ†ïÎêú clean (ÎîîÎ†âÌÜ†Î¶¨ ÏÇ≠Ï†ú ÏïàÏ†Ñ)
clean:
	@echo -e "$(YELLOW)üßπ Cleaning...$(NC)"
	@find $(BUILD_DIR) -type f -delete 2>/dev/null || true
	@find $(BIN_DIR) -type f -delete 2>/dev/null || true
	@echo -e "$(GREEN)‚úÖ Clean completed$(NC)"

# ‚úÖ Ï∂îÍ∞Ä: Í∞ïÏ†ú clean (ÎîîÎ†âÌÜ†Î¶¨ÍπåÏßÄ ÏÇ≠Ï†ú)
clean-all:
	@echo -e "$(YELLOW)üßπ Deep cleaning...$(NC)"
	@rm -rf $(BUILD_DIR) $(BIN_DIR) 2>/dev/null || true
	@echo -e "$(GREEN)‚úÖ Deep clean completed$(NC)"

help:
	@echo -e "$(BLUE)üöÄ PulseOne Export Gateway Makefile$(NC)"
	@echo "====================================="
	@echo ""
	@echo "Main Targets:"
	@echo "  make all          - Build export gateway"
	@echo "  make debug        - Build in debug mode"
	@echo "  make release      - Build in release mode"
	@echo "  make clean        - Clean build files"
	@echo "  make help         - Show this help"
	@echo ""
	@echo "Modules:"
	@echo "  üì° Alarm          - AlarmSubscriber (Redis Pub/Sub)"
	@echo "  üìÖ Schedule       - ScheduledExporter (Cron-based scheduling)"
	@echo "  üîå CSP            - CSP Gateway & Protocol"
	@echo "  üì§ Export         - Export handlers"
	@echo "  üõ†Ô∏è  Utils         - Utilities"
	@echo ""
	@echo "Current: Platform=$(PLATFORM), HAS_HIREDIS=$(HAS_HIREDIS), HAS_CURL=$(HAS_CURL), HAS_OPENSSL=$(HAS_OPENSSL)"
	@echo ""
	@echo -e "$(GREEN)üî• New features:$(NC)"
	@echo "  ‚úÖ AlarmSubscriber - Real-time alarm broadcasting"
	@echo "  ‚úÖ ScheduledExporter - DB-based Cron scheduling"
	@echo "  ‚úÖ ExportScheduleRepository - Schedule management"
	@echo "  ‚úÖ hiredis linked (Redis client)"
	@echo "  ‚úÖ libcurl linked (HTTP/S3)"
	@echo "  ‚úÖ OpenSSL linked (Signing)"

.DEFAULT_GOAL := all

# =============================================================================
# ÌÖåÏä§Ìä∏ ÏÑ§Ï†ï
# =============================================================================

TEST_DIR := tests
TEST_BUILD_DIR := build/tests
TEST_BIN_DIR := bin/tests

TEST_SOURCES := $(wildcard $(TEST_DIR)/*.cpp)
TEST_OBJECTS := $(TEST_SOURCES:$(TEST_DIR)/%.cpp=$(TEST_BUILD_DIR)/%.o)
TEST_TARGETS := $(TEST_SOURCES:$(TEST_DIR)/%.cpp=$(TEST_BIN_DIR)/%)

.PHONY: tests
tests: $(TEST_BIN_DIR) $(TEST_TARGETS)
	@echo -e "‚úÖ All tests built successfully"

$(TEST_BIN_DIR) $(TEST_BUILD_DIR):
	@mkdir -p $@

$(TEST_BIN_DIR)/test_integration: $(TEST_BUILD_DIR)/test_integration.o $(ALARM_OBJECTS) $(SCHEDULE_OBJECTS) $(CSP_OBJECTS) $(EXPORT_OBJECTS) $(UTILS_OBJECTS)
	@echo -e "üîó Linking integration test..."
	@$(CXX) $^ -o $@ $(LDFLAGS)
	@echo -e "‚úÖ Integration test built: $@"

$(TEST_BUILD_DIR)/%.o: $(TEST_DIR)/%.cpp | $(TEST_BUILD_DIR)
	@echo -e "‚öôÔ∏è  Compiling test $<..."
	@$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

.PHONY: test-integration
test-integration: $(TEST_BIN_DIR)/test_integration
	@echo -e "üß™ Running integration tests..."
	@$(TEST_BIN_DIR)/test_integration

.PHONY: test
test: tests
	@echo -e "üß™ Running all tests..."
	@for test in $(TEST_TARGETS); do \
		echo -e "Running $$test..."; \
		$$test || exit 1; \
	done
	@echo -e "‚úÖ All tests passed!"

.PHONY: clean-tests
clean-tests:
	@rm -rf $(TEST_BUILD_DIR) $(TEST_BIN_DIR)

# =============================================================================
# ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ Ï∂úÎ†•
# =============================================================================

.PHONY: debug-vars
debug-vars:
	@echo "=== Source Files ==="
	@echo "ALARM_SOURCES: $(ALARM_SOURCES)"
	@echo "SCHEDULE_SOURCES: $(SCHEDULE_SOURCES)"
	@echo "CSP_SOURCES: $(CSP_SOURCES)"
	@echo ""
	@echo "=== Object Files ==="
	@echo "ALARM_OBJECTS: $(ALARM_OBJECTS)"
	@echo "SCHEDULE_OBJECTS: $(SCHEDULE_OBJECTS)"
	@echo ""
	@echo "=== Total ==="
	@echo "ALL_OBJECTS count: $(words $(ALL_OBJECTS))"