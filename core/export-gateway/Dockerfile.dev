# core/export-gateway/Dockerfile.dev - PulseOne Export Gateway ê°œë°œ í™˜ê²½
FROM gcc:12

# ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (redis-tools ì¶”ê°€!)
RUN apt-get update && apt-get install -y \
    cmake make build-essential \
    libsqlite3-dev sqlite3 \
    curl git pkg-config \
    wget unzip vim nano \
    libssl-dev uuid-dev \
    libcurl4-openssl-dev \
    tree htop procps \
    redis-tools \
    && rm -rf /var/lib/apt/lists/*

# httplib í—¤ë” ë‹¤ìš´ë¡œë“œ
RUN mkdir -p /usr/local/include && \
    wget -O /usr/local/include/httplib.h https://raw.githubusercontent.com/yhirose/cpp-httplib/v0.14.1/httplib.h && \
    chmod 644 /usr/local/include/httplib.h

# nlohmann/json ì„¤ì¹˜
RUN echo "Installing nlohmann/json..." && \
    cd /tmp && \
    git clone --depth 1 --branch v3.11.3 https://github.com/nlohmann/json.git && \
    cd json && mkdir -p build && cd build && \
    cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local -DJSON_BuildTests=OFF && \
    make -j$(nproc) && make install && \
    cd / && rm -rf /tmp/json

# hiredis (Redis í´ë¼ì´ì–¸íŠ¸) ì„¤ì¹˜
RUN echo "Installing hiredis..." && \
    cd /tmp && \
    git clone --depth 1 --branch v1.2.0 https://github.com/redis/hiredis.git && \
    cd hiredis && mkdir -p build && cd build && \
    cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local -DENABLE_SSL=ON && \
    make -j$(nproc) && make install && ldconfig && \
    cd / && rm -rf /tmp/hiredis

# libcurl ì„¤ì • í™•ì¸
RUN echo "libcurl version:" && curl-config --version

# AWS SDKë¥¼ ìœ„í•œ ê¸°ë³¸ ì¤€ë¹„ (í–¥í›„ í™•ìž¥ìš©)
RUN echo "AWS SDK preparation complete"

# ì»´íŒŒì¼ëŸ¬ í™˜ê²½ ì„¤ì •
ENV CC=gcc CXX=g++
ENV CFLAGS="-std=c11 -Wall -Wextra"
ENV CXXFLAGS="-std=c++17 -Wall -Wextra"

# Bash í”„ë¡¬í”„íŠ¸ ì„¤ì •
RUN echo 'export PS1="\[\033[01;36m\]\u@export-gateway\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ "' >> /root/.bashrc && \
    echo 'echo "ðŸŒ PulseOne Export Gateway Development Environment"' >> /root/.bashrc && \
    echo 'echo "================================================="' >> /root/.bashrc && \
    echo 'echo "Installed libraries:"' >> /root/.bashrc && \
    echo 'echo " âœ… httplib (HTTP client)"' >> /root/.bashrc && \
    echo 'echo " âœ… nlohmann/json (JSON processing)"' >> /root/.bashrc && \
    echo 'echo " âœ… hiredis (Redis client)"' >> /root/.bashrc && \
    echo 'echo " âœ… libcurl (HTTP/HTTPS client)"' >> /root/.bashrc && \
    echo 'echo " âœ… redis-tools (Redis CLI)"' >> /root/.bashrc && \
    echo 'echo ""' >> /root/.bashrc && \
    echo 'echo "Development focus:"' >> /root/.bashrc && \
    echo 'echo " ðŸŽ¯ C# CSPGateway porting to C++"' >> /root/.bashrc && \
    echo 'echo " ðŸ“Š Alarm priority processing"' >> /root/.bashrc && \
    echo 'echo " â˜ï¸ AWS S3 integration"' >> /root/.bashrc && \
    echo 'echo " ðŸ”„ API retry logic"' >> /root/.bashrc && \
    echo 'echo ""' >> /root/.bashrc

WORKDIR /app

CMD ["/bin/bash"]