# 🛡️ PulseOne v6.1.0 배포 및 개발 운영 지침 (Standard Operating Procedures)

이 문서는 PulseOne 프로젝트의 무결성을 유지하고, 환경 차이로 인한 소스 코드 오염을 방지하기 위한 **강제 지침**입니다. 모든 개발 및 배포 작업 시 이 지침을 최우선으로 준수해야 합니다.

---

## 🏗️ 1. 개발 및 빌드 환경 원칙

### 🚫 맥(Mac) 호스트 빌드 절대 금지 (Mandatory)
- **현상**: Mac 터미널에서 `make`를 직접 실행할 경우, 리눅스 표준 라이브러리 경로나 헤더 경로 미인식으로 인해 "허위 에러"가 발생합니다.
- **결과**: 이를 코드가 틀린 것으로 착각하여 소스를 수정하게 되면, 이미 검증된 리눅스/윈도우용 배포 코드가 오염됩니다.
- **지침**: 모든 빌드는 반드시 Docker 컨테이너 내부 또는 `docker-compose`를 통해서만 수행합니다.

### 🐳 Docker-Native 워크플로우
- **컴파일/빌드**: `docker-compose build` 또는 `docker exec`를 통해 컨테이너 내부 환경에서 수행합니다.
- **라이브러리 의존성**: 호스트에 라이브러리를 설치하지 마십시오. Dockerfile에 정의된 환경이 최종 진실(Truth)입니다.

---

## 💾 2. 소스 코드 무결성 유지 (Release Integrity)

### 📋 v6.1.0 릴리즈 소스 수정 금지
- 이미 배포에 성공했거나 릴리즈 태그가 달린 버전의 소스 코드는 **절대 수정하지 않습니다.**
- 빌드 에러가 발생한다면 코드를 고치기 전에 **빌드 환경(Makefile, Dockerfile, Env)**을 먼저 점검하십시오.

### 🛠️ 수정 범위의 제한
- 부득이한 빌드 이슈 해결은 **소스 코드(.cpp, .h)가 아닌 Makefile 수정**을 통해 해결하는 것을 원칙으로 합니다.
- 예: 리눅스에서 심볼 충돌 발생 시 함수명을 바꾸는 것이 아니라, `.so` (플러그인) 형태로 빌드하도록 Makefile을 수정합니다.

---

## 📂 3. 표준 경로 및 볼륨 매핑 (Standard Paths)

환경에 상관없이 동일한 설정과 데이터를 참조하기 위해 다음의 경로 표준을 엄격히 준수합니다.

### ⚙️ 설정 파일 (Configuration)
- **Host 경로**: `./config/`
- **Docker 내부 경로**: `/app/config/`
- **파일명 표준**: `collector.env`, `database.env`, `messaging.env` 등
- **원본 유지**: 호스트의 `./config` 폴더가 컨테이너의 `/app/config`로 마운트되므로, 호스트의 파일을 수정하면 컨테이너에 즉시 반영됩니다.

### 🗄️ 데이터베이스 및 데이터 (Data/DB)
- **Host 경로**: `./data/db/`
- **Docker 내부 경로**: `/app/data/db/`
- **SQLite DB 파일**: `pulseone.db`
- **전용 경로 사용**: 로그와 DB 파일은 반드시 `./data` 하위의 지정된 폴더에 저장되어야 하며, Docker 볼륨 매핑을 통해 데이터 휘발을 방지합니다.

### 🪟 Windows / 🐧 Linux 네이티브 배포 (Bare-metal)
Windows와 Linux 네이티브 환경에서도 Docker와 동일한 **상대 경로 구조**를 유지하여 정합성을 맞춥니다.

- **실행 파일 위치**: 배포 패키지의 루트 (예: `pulseone-collector.exe`)
- **설정 파일**: 실행 파일과 동일 경로의 `./config/` 폴더 내 존재
- **데이터/DB**: 실행 파일과 동일 경로의 `./data/db/` 폴더 내 존재
- **주의**: 별도의 `PULSEONE_DATA_DIR` 환경 변수를 지정하지 않는 한, 서비스는 기본적으로 실행 파일 기준 상대 경로(`./data`)를 데이터 저장 공간으로 사용합니다.

---

## 🚫 4. 절대 금지 사항 (Forbidden Actions)

1. **무단 소스 수정**: 사용자의 명시적 승인 없이 함수명을 바꾸거나 로직을 변경하는 행위.
2. **Mac 호스트 테스트**: `Test_Plan.md`에 명시된 "Docker 환경 내 실행" 지침을 위반하고 로컬에서 테스트/빌드하는 행위.
3. **오판 기반 보고**: 환경 문제로 인한 에러를 "코드 버그"로 보고하고 임의로 수정하는 행위.
4. **무분별한 Clean**: 작동 중인 바이너리가 있는 상태에서 호스트 터미널에서 `make clean`을 실행하여 실행 환경을 파괴하는 행위.

---

## 🚀 4. 작업 프로세스 (Forward Procedures)

1. **상태 확인 (Verification First)**: 작업을 시작하기 전, `bin/` 폴더의 바이너리 존재 여부와 Docker 컨테이너의 정상 작동 상태를 먼저 확인합니다.
2. **에러 분석**: 에러 발생 시, 해당 에러가 **Docker 컨테이너 내부**에서도 동일하게 발생하는지 먼저 교차 검증합니다.
3. **수정 제안**: 코드 수정이 필요할 경우, 수정 전후의 영향도를 분석하여 사용자에게 **먼저 승인**을 받습니다.
4. **빌드 및 테스트**: 반드시 `docker-compose up --build` 또는 실행 중인 컨테이너 내에서 테스트 스크립트를 실행하여 검증합니다.

---

> [!IMPORTANT]
> **"환경이 다르면 코드가 아니라 환경을 의심하라."**
> 이미 성공한 빌드는 환경의 정합성만 맞춰주면 다시 성공합니다. 코드를 망가뜨리지 마십시오.
