# ê°œë°œìš© Dockerfile - React Router í¬í•¨
FROM node:18-alpine

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# íŒ¨í‚¤ì§€ ê´€ë¦¬ì ìµœì í™”
RUN npm install -g pnpm@latest

# ê°œë°œì— í•„ìš”í•œ ë„êµ¬ë“¤ ì„¤ì¹˜
RUN apk add --no-cache \
    git \
    curl \
    vim \
    bash

# íŒ¨í‚¤ì§€ íŒŒì¼ë“¤ ë³µì‚¬
COPY package*.json ./
COPY pnpm-lock.yaml* ./

# ğŸ”¥ React Router ì˜ì¡´ì„±ì„ package.jsonì— ë¯¸ë¦¬ ì¶”ê°€
RUN npm pkg set dependencies.react-router-dom="^6.20.1"
RUN npm pkg set devDependencies.@types/react-router-dom="^6.20.1"

# ì˜ì¡´ì„± ì„¤ì¹˜ (ê°œë°œ ì˜ì¡´ì„± í¬í•¨)
RUN pnpm install --frozen-lockfile=false

# viteê°€ ì œëŒ€ë¡œ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
RUN pnpm list vite
RUN which vite || pnpm add -g vite

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# ê°œë°œ ì„œë²„ í¬íŠ¸
EXPOSE 5173

# Hot Reloadë¥¼ ìœ„í•œ í™˜ê²½ë³€ìˆ˜
ENV CHOKIDAR_USEPOLLING=true
ENV VITE_HMR_HOST=0.0.0.0

# ê°œë°œ ì„œë²„ ì‹¤í–‰
CMD ["pnpm", "run", "dev", "--host", "0.0.0.0"]