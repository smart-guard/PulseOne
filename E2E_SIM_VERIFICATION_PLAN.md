# PulseOne μ‹¤λ¬΄ν• μ—”λ“ν¬μ—”λ“(E2E) ν…μ¤νΈ κ³„νμ„

μ΄ κ³„νμ„λ” κ°€μ¥ κΈ°λ³Έμ μΈ λ°μ΄ν„° μμ§‘λ¶€ν„° λ³µμ΅ν• μλ™ νƒμƒ‰ μμΌλ΅ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•λ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤. λ¨λ“  κ³Όμ •μ€ μ‹¤μ  ν„μ¥ μ‹λ‚λ¦¬μ¤μ™€ λ™μΌν•κ² λ¨λ“λ²„μ¤ λ° MQTT μ‹λ®¬λ μ΄ν„°λ¥Ό κΈ°λ°μΌλ΅ μν–‰λ©λ‹λ‹¤.

## π¨ μµμ°μ„  μ§€μΉ¨: Docker ν™κ²½ λ‚΄ μ‹¤ν–‰ (Mandatory)
λ³Έ ν”„λ΅μ νΈμ λ¨λ“  ν…μ¤νΈ λ…λ Ήμ–΄λ” **μ λ€λ΅ λ§¥(Mac) ν„°λ―Έλ„μ—μ„ μ§μ ‘ μ‹¤ν–‰ν•μ§€ μ•μµλ‹λ‹¤.** λ°λ“μ‹ Docker μ»¨ν…μ΄λ„μ— μ ‘μ†ν•κ±°λ‚ `docker exec` λ…λ Ήμ–΄λ¥Ό ν†µν•΄μ„λ§ μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤.

---

## π“‹ κ¶μ¥ ν…μ¤νΈ μμ„ (Test Sequence)

1.  **Phase 1: Modbus λ°μ΄ν„° μμ§‘ κ²€μ¦** (κΈ°μ΄ μ¥μΉ μ—°κ²° λ° μ‹¤μ‹κ°„ λ°μ΄ν„° ν™•μΈ)
2.  **Phase 2: Modbus μ•λ λ°μƒ λ° UI λ™κΈ°ν™” κ²€μ¦** (μ„κ³„κ°’ κΈ°λ° μ•λ λ° μ „μ†΅ νμ΄ν”„λΌμΈ)
3.  **Phase 3: Export Gateway μ—°λ™ κ²€μ¦** (μ™Έλ¶€ S3/HTTP μµμΆ… μ—…λ΅λ“ λ° μ •κ·ν™”)
4.  **Phase 4: MQTT μλ™ νƒμƒ‰ λ° ν¬μΈνΈ λ™κΈ°ν™” κ²€μ¦** (μ λ™μ  ν¬μΈνΈ κ΄€λ¦¬ λ° λ°μ΄ν„° νƒμƒ‰)

---

## 1. μ „μ  μ΅°κ±΄ λ° ν™κ²½ μ¤€λΉ„
- **λ°μ΄ν„°λ² μ΄μ¤ κ²½λ΅**: `/app/data/db/pulseone.db`
- **μ»¨ν…μ΄λ„ λ©λ΅**: `docker-collector-1`, `docker-backend-1`, `docker-redis-1`, `docker-simulator-modbus-1`, `docker-export-gateway-1`

---

## 2. [Phase 1] Modbus λ°μ΄ν„° μμ§‘ κ²€μ¦

### 2.1. μ¥μΉ μ—°κ²° λ° λ΅κ·Έ ν™•μΈ
1.  **μ—°κ²° μƒνƒ**: μ›Ή UI λλ” λ΅κ·Έμ—μ„ Modbus μ¥μΉ(IP: `simulator-modbus`, Port: 50502)μ μ •μƒ μ—°κ²° ν™•μΈ.
2.  **λ΅κ·Έ ν™•μΈ**:
    ```bash
    docker logs docker-collector-1 | grep "Modbus"
    ```

### 2.2. Redis μ‹¤μ‹κ°„ λ°μ΄ν„° κ²€μ¦ (DB 0 λλ” DB 2)
1.  **Redis μ΅°ν**:
    ```bash
    docker exec docker-redis-1 redis-cli -n 0 GET "device:2:WLS.SSS"
    ```
    - μ¥μΉ ID 2λ²μ λ μ§€μ¤ν„° κ°’λ“¤μ΄ μ‹¤μ‹κ°„μΌλ΅ μ—…λ°μ΄νΈλλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

---

## 3. [Phase 2] Modbus μ•λ λ°μƒ λ° μ „μ†΅ κ²€μ¦

### 3.1. μ•λ μ„κ³„κ°’ μ„¤μ •
- μ›Ή UI: 'μ•λ μ„¤μ •' λ©”λ‰΄μ—μ„ `WLS.SSS` ν¬μΈνΈμ— λ€ν•΄ `Value > 100` μ΅°κ±΄ μ„¤μ •.

### 3.2. μ•λ νΈλ¦¬κ±° λ° UI/DB ν™•μΈ
1.  **κ°•μ  κ°’ λ³€κ²½ (Simulator μ»¨νΈλ΅¤)**:
    ```bash
    # μ•λ λ°μƒ (μ„κ³„μΉ 100 μ΄κ³Ό)
    docker exec docker-simulator-modbus-1 node /app/backend/scripts/force_modbus.js 200 150 register
    ```
2.  **UI λ™κΈ°ν™” ν™•μΈ**:
    - λ€μ‹λ³΄λ“ λ―Έν™•μΈ μ•λ μ«μμ™€ μ‚¬μ΄λ“λ°” λ°°μ§€κ°€ **λ™μ‹**μ— μ—…λ°μ΄νΈλλ”μ§€ ν™•μΈ.
3.  **DB λ° Redis μƒνƒ ν™•μΈ**:
    ```bash
    docker exec docker-collector-1 sqlite3 /app/data/db/pulseone.db "SELECT * FROM alarm_occurrences ORDER BY id DESC LIMIT 1;"
    docker exec docker-redis-1 redis-cli -n 0 GET "alarm:active:25"
    ```

---

## 4. [Phase 3] Export Gateway μ—°λ™ κ²€μ¦

### 4.1. νμ΄λ΅λ“ μ „λ‹¬ λ° μ™Έλ¶€ μ—…λ΅λ“ ν™•μΈ
1.  **Gateway λ΅κ·Έ λ¨λ‹ν„°λ§**:
    ```bash
    docker logs -f docker-export-gateway-1
    ```
    - μ•λ λ°μƒ μ‹ μ¦‰μ‹ μ΄λ²¤νΈλ¥Ό μμ‹ ν•κ³  S3 λλ” HTTP νƒ€κ²μΌλ΅ μ—…λ΅λ“ μ‹λ„ ν™•μΈ.
    - `S3 Upload Success` λλ” `HTTP 200 OK` λ©”μ‹μ§€ ν™•μΈ.

---

## 5. [Phase 4] MQTT μλ™ νƒμƒ‰ λ° ν¬μΈνΈ λ™κΈ°ν™” κ²€μ¦

### 5.1. μλ™ νƒμƒ‰ (Auto-Discovery)
1.  **MQTT λ°μ΄ν„° λ°ν–‰**:
    ```bash
    docker exec docker-backend-1 node scripts/mqtt_simulator.js
    ```
2.  **DB λ° μ‹¤μ‹κ°„ λ°μ΄ν„° ν™•μΈ**:
    - DBμ— μ‹ κ· ν¬μΈνΈ(`topic`) μλ™ μƒμ„± ν™•μΈ.
    - Redis `device:*:current`μ— ν•΄λ‹Ή ν¬μΈνΈμ μ‹¤μ‹κ°„ λ°μ΄ν„° μ μ… ν™•μΈ.

### 5.2. ν¬μΈνΈ λ™κΈ°ν™” λ° μ •λ¦¬ (Cleanup)
- μ¥μΉ μ„¤μ • λ³€κ²½ μ‹ μ μ™Έλ ν† ν”½μ΄ DBμ™€ Redisμ—μ„ μλ™μΌλ΅ μ κ±°(Cleanup)λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

---

## 6. μµμΆ… μ²΄ν¬λ¦¬μ¤νΈ
- [x] λ¨λ“  μ‘μ—…μ΄ `docker exec`λ¥Ό ν†µν•΄ μν–‰λμ—λ”κ°€?
- [x] μμ§‘λ λ°μ΄ν„°κ°€ Redisμ— μ¦‰μ‹ λ°μλλ”κ°€?
- [x] μ•λ λ°μƒ ν›„ UIμ™€ μ‚¬μ΄λ“λ°”κ°€ μ¦‰μ‹ λ™κΈ°ν™”λλ”κ°€?
- [x] Export Gatewayκ°€ μ™Έλ¶€(Cloud)λ΅ λ°μ΄ν„°λ¥Ό μ¤‘λ‹¨ μ—†μ΄ μ „λ‹¬ν•λ”κ°€?
