# PulseOne μ‹¤λ¬΄ν• μ—”λ“ν¬μ—”λ“(E2E) ν…μ¤νΈ κ³„νμ„

## π¨ μµμ°μ„  μ§€μΉ¨: Docker ν™κ²½ λ‚΄ μ‹¤ν–‰ (Mandatory)
λ³Έ ν”„λ΅μ νΈμ λ¨λ“  ν…μ¤νΈ λ…λ Ήμ–΄λ” **μ λ€λ΅ λ§¥(Mac) ν„°λ―Έλ„μ—μ„ μ§μ ‘ μ‹¤ν–‰ν•μ§€ μ•μµλ‹λ‹¤.** λ°λ“μ‹ Docker μ»¨ν…μ΄λ„μ— μ ‘μ†ν•κ±°λ‚ `docker exec` λ…λ Ήμ–΄λ¥Ό ν†µν•΄μ„λ§ μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤.

---

## π“‹ κ¶μ¥ ν…μ¤νΈ μμ„ (Test Sequence)

λ³Έ κ³„νμ„λ” κ°€μ¥ κΈ°λ³Έμ μΈ λ°μ΄ν„° μμ§‘λ¶€ν„° λ³µμ΅ν• μλ™ νƒμƒ‰ μμΌλ΅ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•λ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.

1.  **Phase 1: Modbus λ°μ΄ν„° μμ§‘ κ²€μ¦** (κΈ°μ΄ μ¥μΉ μ—°κ²° ν•„ν„°λ§)
2.  **Phase 2: Modbus μ•λ λ°μƒ λ° μ „μ†΅ κ²€μ¦** (μ„κ³„κ°’ λ° μ΄λ²¤νΈ νμ΄ν”„λΌμΈ)
3.  **Phase 3: Export Gateway μ—°λ™ κ²€μ¦** (μ™Έλ¶€ S3/HTTP μµμΆ… μ—…λ΅λ“)
4.  **Phase 4: MQTT μλ™ νƒμƒ‰ λ° ν¬μΈνΈ λ™κΈ°ν™” κ²€μ¦** (μ λ™μ  ν¬μΈνΈ κ΄€λ¦¬)

---

## 1. μ „μ  μ΅°κ±΄ λ° ν™κ²½ μ¤€λΉ„
- **λ°μ΄ν„°λ² μ΄μ¤ κ²½λ΅**: `/app/data/db/pulseone.db`
- **μ»¨ν…μ΄λ„ κΈ°λ™**: `cd docker && docker-compose up -d`

---

## 2. [Phase 1] Modbus λ°μ΄ν„° μμ§‘ κ²€μ¦

### 2.1. μ¥μΉ λ“±λ΅ λ° μ½λ ‰ν„° κ°€λ™
1.  **μ¥μΉ λ“±λ΅**: μ›Ή UIμ—μ„ Modbus μ¥μΉ λ“±λ΅ (IP: `simulator-modbus`, Port: 50502).
2.  **λ΅κ·Έ ν™•μΈ**: μ½λ ‰ν„° μ»¨ν…μ΄λ„μ—μ„ μ •μƒ μ—°κ²° μ—¬λ¶€ ν™•μΈ.
    ```bash
    docker logs -f pulseone-collector | grep "Modbus"
    ```

### 2.2. Redis μ‹¤μ‹κ°„ λ°μ΄ν„° κ²€μ¦
1.  **Redis μ ‘μ† λ° μ΅°ν**:
    ```bash
    docker exec -it pulseone-redis redis-cli HGETALL "device:1:current"
    ```
    - μ¥μΉ ID 1λ²μ λ μ§€μ¤ν„° κ°’λ“¤μ΄ μ‹¤μ‹κ°„μΌλ΅ μ—…λ°μ΄νΈλλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

---

## 3. [Phase 2] Modbus μ•λ λ°μƒ λ° μ „μ†΅ κ²€μ¦

### 3.1. μ•λ μ„κ³„κ°’ μ„¤μ •
1.  μ›Ή UIμ 'μ•λ μ„¤μ •' λ©”λ‰΄μ—μ„ Modbus ν¬μΈνΈ(μ: SSS)μ— λ€ν•΄ `Value > 150` μ΅°κ±΄μ„ μ„¤μ •ν•©λ‹λ‹¤.

### 3.2. μ•λ νΈλ¦¬κ±° λ° DB ν™•μΈ
1.  **κ°•μ  κ°’ λ³€κ²½ (Simulator μ»¨νΈλ΅¤)**:
    ```bash
    docker exec -it pulseone-backend node scripts/force_modbus.js --id 2002 --value 151
    ```
2.  **μ•λ λ‚΄μ—­ ν™•μΈ (SQLite)**:
    ```bash
    docker exec -it pulseone-collector sqlite3 /app/data/db/pulseone.db "SELECT * FROM alarm_occurrences ORDER BY id DESC LIMIT 1;"
    ```
    - μ‹ κ· μ•λμ΄ `status='active'` μƒνƒλ΅ μƒμ„±λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

---

## 4. [Phase 3] Export Gateway μ—°λ™ κ²€μ¦

### 4.1. νμ΄λ΅λ“ μ „λ‹¬ ν™•μΈ
1.  **Export Gateway λ΅κ·Έ λ¨λ‹ν„°λ§**:
    ```bash
    docker logs -f pulseone-export-gateway
    ```
    - μ•λ λ°μƒ μ‹ μ¦‰μ‹ μ΄λ²¤νΈλ¥Ό μμ‹ ν•κ³  νƒ€κ²(S3/HTTP)μΌλ΅ μ—…λ΅λ“λ¥Ό μ‹λ„ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    - `S3 Upload Success` λλ” `HTTP 200 OK` λ©”μ‹μ§€ ν™•μΈ.

---

## 5. [Phase 4] MQTT μλ™ νƒμƒ‰ λ° ν¬μΈνΈ λ™κΈ°ν™” κ²€μ¦

### 5.1. μλ™ νƒμƒ‰ (Auto-Discovery)
1.  **MQTT λ°μ΄ν„° λ°ν–‰**:
    ```bash
    docker exec -it pulseone-backend node scripts/mqtt_simulator.js
    ```
2.  **DB λ° Redis λ™μ‹ ν™•μΈ**:
    - DBμ— μ‹ κ· ν¬μΈνΈ μλ™ μƒμ„± ν™•μΈ.
    - Redis `device:300:current`μ— ν•΄λ‹Ή ν¬μΈνΈμ μ‹¤μ‹κ°„ λ°μ΄ν„° μƒμ„± ν™•μΈ.

### 5.2. ν¬μΈνΈ λ™κΈ°ν™” (Sync & Cleanup)
1.  **ν¬μΈνΈ μ‚­μ  ν…μ¤νΈ**: μ¥μΉ μ„¤μ •μ—μ„ μ μ™Έλ ν† ν”½μ΄ DBμ™€ Redisμ—μ„ μλ™μΌλ΅ μ κ±°(Cleanup)λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

---

## 6. μµμΆ… μ²΄ν¬λ¦¬μ¤νΈ
- [x] λ¨λ“  μ‘μ—…μ΄ `docker exec`λ¥Ό ν†µν•΄ μν–‰λμ—λ”κ°€?
- [x] μμ§‘λ λ°μ΄ν„°κ°€ Redisμ— μ¦‰μ‹ λ°μλλ”κ°€?
- [x] μ•λ λ°μƒ ν›„ Export Gatewayκ°€ μ¤‘λ‹¨ μ—†μ΄ μ™Έλ¶€λ΅ μ „λ‹¬ν•λ”κ°€?
