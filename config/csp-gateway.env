# =============================================================================
# CSP Gateway 설정 파일 (csp-gateway.env) - 기존 C# 버전 완전 포팅
# 기존 iCos5CSPGateway 설정과 100% 호환
# =============================================================================

# =============================================================================
# CSP Gateway 기본 설정
# =============================================================================
CSP_GATEWAY_ENABLED=true
CSP_GATEWAY_SERVICE_NAME=PulseOne CSP Gateway
CSP_GATEWAY_VERSION=1.8
CSP_GATEWAY_BUILDING_ID=1001

# 서비스 모드 설정
CSP_GATEWAY_DEBUG_MODE=true
CSP_GATEWAY_MAINTENANCE_MODE=false
CSP_GATEWAY_MAX_WORKER_THREADS=4
CSP_GATEWAY_QUEUE_MAX_SIZE=10000

# =============================================================================
# API 전송 설정
# =============================================================================
CSP_API_ENABLED=true
CSP_API_ENDPOINT=https://api.pulseone.com/v1/alarms
CSP_API_KEY_FILE=${SECRETS_DIR}/csp_api_key.key
CSP_API_TIMEOUT_MS=10000
CSP_API_CONTENT_TYPE=application/json

# 재시도 설정
CSP_API_MAX_RETRY=3
CSP_API_RETRY_DELAY_MS=1000
CSP_API_RETRY_BACKOFF=exponential

# =============================================================================
# AWS S3 업로드 설정 (기존 C# 버전과 동일)
# =============================================================================
CSP_S3_ENABLED=true
CSP_S3_BUCKET_NAME=pulseone-alarm-data
CSP_S3_REGION=ap-northeast-2
CSP_S3_ACCESS_KEY_FILE=${SECRETS_DIR}/aws_access_key.key
CSP_S3_SECRET_KEY_FILE=${SECRETS_DIR}/aws_secret_key.key

# S3 업로드 경로 패턴
CSP_S3_OBJECT_PREFIX=alarms/{building_id}/
CSP_S3_FILE_NAME_PATTERN={building_id}_{timestamp}_alarm.json

# S3 재시도 설정 (기존 버전: 10초 timeout)
CSP_S3_TIMEOUT_MS=10000
CSP_S3_MAX_RETRY=3
CSP_S3_RETRY_DELAY_MS=2000

# =============================================================================
# Insite 연동 설정 (기존 C# CSP Gateway ver1.6 기능)
# =============================================================================
CSP_INSITE_ENABLED=false
CSP_INSITE_ENDPOINT=https://insite.pulseone.com/api/v1/data
CSP_INSITE_API_KEY_FILE=${SECRETS_DIR}/insite_api_key.key
CSP_INSITE_TIMEOUT_MS=5000

# 제어 비활성화 시 DB 비우기 설정 (ver1.5 Hotfix)
CSP_INSITE_CONTROL_DISABLED=true
CSP_INSITE_CONTROL_CLEAR_INTERVAL_HOURS=24

# =============================================================================
# Inbase 연동 설정 (기존 C# CSP Gateway ver1.6 기능)
# =============================================================================
CSP_INBASE_ENABLED=false
CSP_INBASE_ENDPOINT=https://inbase.pulseone.com/api/v1/upload
CSP_INBASE_API_KEY_FILE=${SECRETS_DIR}/inbase_api_key.key
CSP_INBASE_TIMEOUT_MS=8000

# =============================================================================
# BEMS 업로드 설정 (기존 C# CSP Gateway ver1.7 기능)
# =============================================================================
CSP_BEMS_ENABLED=false
CSP_BEMS_ENDPOINT=https://bems.pulseone.com/api/v1/building-data
CSP_BEMS_API_KEY_FILE=${SECRETS_DIR}/bems_api_key.key
CSP_BEMS_BUILDING_ID=${CSP_GATEWAY_BUILDING_ID}
CSP_BEMS_TIMEOUT_MS=15000

# =============================================================================
# 알람 필터링 설정
# =============================================================================
# 알람 우선순위 필터 (1=Critical, 2=High, 3=Medium, 4=Low, 5=Info)
CSP_ALARM_MIN_PRIORITY=1
CSP_ALARM_MAX_PRIORITY=4

# 태그 필터 패턴 (정규식)
CSP_ALARM_TAG_INCLUDE_PATTERN=.*
CSP_ALARM_TAG_EXCLUDE_PATTERN=^TEST_.*

# 시간 필터 (오래된 알람 무시)
CSP_ALARM_MAX_AGE_HOURS=24

# =============================================================================
# 데이터 처리 설정
# =============================================================================
# Modbus 태그 관련 (기존 C# 버전 이슈 수정 사항 적용)
CSP_MODBUS_ALARM_TIMEZONE=LOCAL_TIME  # ver1.2: UTC -> Local time
CSP_MODBUS_UPDATE_TIME_SOURCE=DATA_TIME  # ver1.2: 데이터 취득시간 사용
CSP_MODBUS_INVALID_VALUE_THRESHOLD=-2147483638  # ver1.3: 비정상값 임계치
CSP_MODBUS_USE_PREVIOUS_ON_INVALID=true  # ver1.3: 비정상값 시 이전값 사용

# 알람 처리 시간 설정 (ver1.1 기능)
CSP_UPDATE_TIME_OPTION=SCADA_TIME  # SCADA_TIME 또는 DRIVER_TIME

# =============================================================================
# 로그 및 모니터링 설정
# =============================================================================
CSP_DETAILED_LOGGING=true  # ver1.1: 상세로깅
CSP_LOG_VALUE_FILE_SAVE=true  # 파일명/관제점수 로깅
CSP_LOG_UPDATE_TIME_ERROR=true  # 1900년 이하 오류 로깅
CSP_LOG_NETWORK_RECONNECT=true  # 네트워크 재접속 로깅

# 성능 모니터링
CSP_PERFORMANCE_MONITORING=true
CSP_STATS_UPDATE_INTERVAL_MS=30000
CSP_HEALTH_CHECK_INTERVAL_MS=60000

# =============================================================================
# 실패 처리 설정
# =============================================================================
# 실패한 알람 파일 저장
CSP_FAILED_ALARM_SAVE_ENABLED=true
CSP_FAILED_ALARM_SAVE_PATH=${DATA_DIR}/failed_alarms/
CSP_FAILED_ALARM_FILE_PATTERN=failed_{timestamp}_alarm.json

# 실패한 알람 재처리
CSP_FAILED_ALARM_RETRY_ENABLED=true
CSP_FAILED_ALARM_RETRY_INTERVAL_MINUTES=30
CSP_FAILED_ALARM_MAX_RETRY_COUNT=5

# =============================================================================
# 배치 처리 설정
# =============================================================================
CSP_BATCH_PROCESSING_ENABLED=true
CSP_BATCH_SIZE=100
CSP_BATCH_TIMEOUT_MS=5000
CSP_BATCH_FLUSH_INTERVAL_MS=10000

# =============================================================================
# 스케줄 설정 (기존 C# 버전 ver1.1 정각시간 누락 오류 수정 반영)
# =============================================================================
CSP_SCHEDULE_ENABLED=true
CSP_SCHEDULE_HOURLY_AT_ZERO=true  # 매시 00분 스케줄 처리
CSP_SCHEDULE_MISSED_EXECUTION_HANDLING=EXECUTE_IMMEDIATELY

# =============================================================================
# 네트워크 설정 (기존 C# 버전 ver1.1 설정 반영)
# =============================================================================
CSP_NETWORK_RECONNECT_ENABLED=true
CSP_NETWORK_RECONNECT_TIMEOUT_MS=30000
CSP_NETWORK_SERVICE_RESTART_ON_RECONNECT=true  # ver1.1: 네트워크 재접속 시 서비스 재시작

# =============================================================================
# 보안 설정
# =============================================================================
CSP_SSL_ENABLED=true
CSP_SSL_VERIFY_PEER=true
CSP_SSL_CERT_FILE=${SECRETS_DIR}/csp_client.crt
CSP_SSL_KEY_FILE=${SECRETS_DIR}/csp_client.key
CSP_SSL_CA_FILE=${SECRETS_DIR}/csp_ca.crt

# =============================================================================
# 호환성 설정 (기존 C# 버전과 호환성 유지)
# =============================================================================
# 기존 HDC CSP Gateway 호환 모드
CSP_HDC_COMPATIBILITY_MODE=false
CSP_HDC_LEGACY_TIME_FORMAT=false

# Cloud Gateway 별칭 지원 (ver1.7에서 Title 변경됨)
CSP_CLOUD_GATEWAY_MODE=true
CSP_SERVICE_TITLE=Cloud Gateway